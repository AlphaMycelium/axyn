![Axyn logo](images/axyn.png)

# Axyn

[![Maintainability](https://api.codeclimate.com/v1/badges/a86290ca2ee89d387756/maintainability)](https://codeclimate.com/github/AlphaMycelium/axyn/maintainability)

A simple Discord chatbot.

## Run

Set the environment variable `DISCORD_TOKEN` to your Discord bot token. This is
needed to access the Discord API. Then, simply launch `axyn/main.py`.

## Usage

### Chat

You can chat to Axyn at any time by sending it a DM. It will display the typing
status while a response is generated. If the bot stops typing and nothing is
sent, this means that it didn't know how to respond or was less than 50%
certain.

Axyn will also respond to messages in servers, if noone else has responded
within 3 minutes and it is more than 80% certain.

### Reactions

Axyn adds reactions to messages it receives, both in servers and DMs, if it has
learned any which match that message.

### DisplaCy

Axyn provides the command `a!analyse`, which displays a dependency parse
for the given text. This is generated by SpaCy and rendered with DisplaCy.
A reference of what the different dependency types mean is available
[here](https://spacy.io/api/annotation#dependency-parsing-english).

## How does it work?

*This was originally a wrapper around
[Chatterbot](https://github.com/gunthercox/ChatterBot), however response times
were getting far too slow and I was customizing the behaviour a lot. In the end
I wrote my own implementation following the same basic principles.*

Axyn learns how to respond based on messages it receives. It tries to guess
which other message the message is in response to, and saves it. If someone
sends the first message again, it will find the stored response and re-use it.

Bigram pairs are used to select previously seen messages from the database
which it thinks might be a match fo the message it receives. This means that we
don't need to do heavy computations on every single sentence that is stored to
find a match.

Word embeddings are used to calculate an average vector for each the selected
candidates, then `scipy.spatial.KDTree` is used to perform a nearest-neighbour
search on these vectors to find the closest match. The distance between the
two vectors is used to compute a confidence value.

Finally, the response that was sent after the matching message is recalled. If
there have been multiple responses, Axyn tries to select the most common, but
if there is no mode then it will just pick one at random.
